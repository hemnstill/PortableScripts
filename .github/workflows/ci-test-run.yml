name: ci test-run

on: [pull_request]

jobs:
  python-ubuntu-host:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2

    - name: test-run
      run: ./Python/test-run.sh

  python-alpine-docker:
    runs-on: ubuntu-latest
    container: alpine:latest
    steps:
    - uses: actions/checkout@v2

    - name: test-run
      run: |
        apk add --no-cache bash zstd
        ./Python/test-run.sh

  python-windows-host:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v2

    - name: test-run
      shell: cmd
      run: |
        .tools\busybox64.exe sh Python\test-run.sh

  python-nanoserver-docker:
    runs-on: windows-2022
    env:
      IMAGE_NAME: mcr.microsoft.com/windows/nanoserver:ltsc2022-amd64

    steps:
    - uses: actions/checkout@v2
    - name: pull windows container ${{ env.IMAGE_NAME }}
      shell: cmd
      run: |
        docker pull ${{ env.IMAGE_NAME }}
        docker images ${{ env.IMAGE_NAME }}

    - name: test-run
      shell: cmd
      run: >
        docker container run --rm --env CI=true -v ${{ github.workspace }}:C:\app -w C:\app ${{ env.IMAGE_NAME }}
        .tools\busybox64.exe sh Python\test-run.sh